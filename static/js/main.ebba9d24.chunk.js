(this["webpackJsonpone-pic"]=this["webpackJsonpone-pic"]||[]).push([[0],{106:function(e,t,n){},107:function(e,t,n){},116:function(e,t,n){},139:function(e,t,n){},141:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(18),c=n.n(o),s=(n(106),n(107),n(108),n(48)),r=n(49),l=n(64),d=n(63),m=n(143),u=n(96),h=n(146),g=n(145),p=n(85),f=n.n(p),j=n(149),b=n(144),v=n(147),x=n(65),w=n(148),O="http://img.uwayfly.com/";function y(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=!0,i=0;i<t.length;i++)if(e.indexOf(t[i])>0){n=!1;break}return n}var S=function(e,t){return"".concat(e,"?imageView2/2/w/").concat(t)},N=(n(116),n(6)),L=0,T=0,M=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(s.a)(this,n),(i=t.call(this,e)).onBindTouchStart=function(e){var t=e.changedTouches;L=t[0].clientX,t[0].clientY},i.onBindTouchMove=function(e){if(!(e.target&&e.target.classList&&e.target.classList.contains("description"))){var t=e.changedTouches;T=t[0].clientX,t[0].clientY,L-T>10?i.onToNext():L-T<-10&&i.onToLast()}},i.onToLast=function(){var e=i.state.preViewIndex;e<=0||i.setState({preViewIndex:e-1})},i.onToNext=function(){var e=i.state.preViewIndex,t=i.props,n=t.imageList,a=t.onGetMoreData;e>=n.length-3&&"function"===typeof a&&a(),e>=n.length-1||i.setState({preViewIndex:e+1})},i.onBindKeyUp=function(e){37===e.keyCode?i.onToLast():39===e.keyCode&&i.onToNext()},i.onCancelModal=function(e){e.stopPropagation(),e.preventDefault(),i.props.cancelModal()},i.onClickImg=function(e){console.log(e)},i.onDownLoadImg=function(e){var t=i.props.imageList[i.state.preViewIndex].origin_name,n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onload=function(){var e=document.createElement("canvas");e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(n,0,0,n.width,n.height);var i=e.toDataURL("image/png"),a=document.createElement("a"),o=new MouseEvent("click");a.download=t||"photo",a.href=i,a.dispatchEvent(o)},n.src=e},i.onGetSmallImgSrc=function(e){var t=i.state.imgWidth;return console.log("imgWidth: ",t),t?S(e,t):(i.onComputeImgWidth(),e)},i.onComputeImgWidth=function(){if(i.imgRef.current){var e=i.imgRef.current;i.imgRef.current.onload=function(){console.log("onload offsetWidth",e.offsetWidth),i.setState({imgWidth:2*e.offsetWidth})}}},i.imgRef=a.a.createRef(),i.state={preViewIndex:e.preViewIndex||0,imgWidth:0},i}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("keyup",this.onBindKeyUp),window.addEventListener("touchstart",this.onBindTouchStart),window.addEventListener("touchend",this.onBindTouchMove),setTimeout((function(){e.setState({showBtnLine:!0})}),400)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keyup",this.onBindKeyUp),window.removeEventListener("touchstart",this.onBindTouchStart),window.removeEventListener("touchend",this.onBindTouchMove)}},{key:"render",value:function(){var e=this,t=this.props.imageList,n=this.state,i=n.preViewIndex,a=n.showBtnLine,o=t[i].realUrl;return Object(N.jsxs)(b.a,{centered:!0,visible:!0,footer:null,onCancel:this.props.cancelModal,style:{width:"auto"},className:"priview-modal",maskStyle:{background:"rgba(0, 0, 0, 0.9)"},children:[Object(N.jsxs)("div",{className:"btn-line ".concat(a?"show":""),children:[Object(N.jsx)("a",{href:o,target:"_blank",className:"check-origin-img btn",children:"\u67e5\u770b\u539f\u56fe"}),Object(N.jsx)("span",{className:"download-img btn",onClick:function(){return e.onDownLoadImg(o)},children:"\u4e0b\u8f7d"})]}),Object(N.jsx)("div",{className:"half-preview half-left",onClick:this.onToLast,children:i>0&&Object(N.jsxs)("span",{className:"preview-handle last-one",children:["\u4e0a\u4e00\u5f20",Object(N.jsx)(v.a,{style:{fontSize:50,margin:"0 6px"}})]})}),Object(N.jsxs)("div",{className:"img-wrap",children:[Object(N.jsx)("img",{alt:"",src:this.onGetSmallImgSrc(o),onClick:this.onClickImg,ref:this.imgRef}),Object(N.jsx)("div",{className:"description",children:t[i]&&t[i].showDesc}),Object(N.jsx)(x.a,{onClick:this.onCancelModal,onTouchEnd:this.onCancelModal,style:{userSelect:"none"}})]}),Object(N.jsx)("div",{className:"half-preview half-right",onClick:this.onToNext,children:i<t.length-1&&Object(N.jsxs)("span",{className:"preview-handle next-one",children:[Object(N.jsx)(w.a,{style:{fontSize:50,margin:"0 6px"}}),"\u4e0b\u4e00\u5f20"]})})]})}}]),n}(a.a.Component),I=n(37),k=n(90),W=n.n(k),C=n(91);var E=function(e){var t=e.url,n=e.method,i=void 0===n?"GET":n,a=e.data,o=void 0===a?{}:a,c=e.headers,s=void 0===c?{}:c,r={method:i,data:o,url:t,headers:Object(I.a)(Object(I.a)({},s),{},{"Content-Type":"application/x-www-form-urlencoded"})};return"POST"===i||"PUT"===i?r.data=Object(C.stringify)(o):r.params=o,new Promise((function(e,t){W()(Object(I.a)({},r)).then((function(t){e({data:t.data})})).catch((function(e){e.msg&&u.b.error(e.msg)}))}))};n(139);var R=m.a.Search,V=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(s.a)(this,n),(i=t.call(this,e)).onGetSmallPic=function(){if(i.imageListWrapRef&&i.imageListWrapRef.current){var e=i.imageListWrapRef.current.querySelectorAll("img");e&&e[0]&&i.setState({imgWidth:2*e[0].parentNode.offsetWidth},(function(){i.fakeImageItemRef.current.style="display: none;"}))}},i.onSetSearchMaxWidth=function(){i.imageListWrapRef&&i.imageListWrapRef.current&&i.imageListWrapRef.current.offsetWidth&&i.setState({searchMaxWidth:Math.min(630,i.imageListWrapRef.current.offsetWidth)})},i.onJudgeMobile=function(){i.setState({isMobile:!y()})},i.onJudgeScreenWidth=function(){var e="default",t=document.body.clientWidth;t<1e3?e="default":t<600&&(e="small"),i.setState({marinSearchSize:e})},i.onBindScroll=function(){var e=i.state,t=e.pageNo,n=e.imageTotal,a=e.imageList,o=e.loading;n<=a.length||o||function(){var e=0;return document.documentElement&&document.documentElement.scrollTop?e=document.documentElement.scrollTop:document.body&&(e=document.body.scrollTop),e}()+(document.body.clientHeight&&document.documentElement.clientHeight?Math.min(document.body.clientHeight,document.documentElement.clientHeight):Math.max(document.body.clientHeight,document.documentElement.clientHeight))+100>=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)&&i.setState({pageNo:t+1},(function(){i.onGetImages()}))},i.onGetImages=function(e){var t,n=i.state,a=n.imageList,o=n.imageTotal,c=n.pageNo,s=n.searchVal,r=n.extraLoadTimes;i.setState({loading:!0}),(t={pageNo:c,pageSize:8,search:s},E({url:"".concat("https://uwayfly.com/api","/images"),data:Object(I.a)(Object(I.a)({},t),{},{type:"one"})})).then((function(t){var n=t.data||{};o=n.count||0;var c=n.data||[];c.map((function(e){e.pureQiniuKey=e.qiniu_key.replace(".jpg",""),e.realUrl=O+e.qiniu_key,e.showDesc="".concat(e.description," - ").concat(e.pureQiniuKey),!e.stamp&&e.qiniu_key?e.stamp=function(e){if(e)return e=Number(e),new Date("2021-02-07").getTime()-864e5*(3046-e)}(e.pureQiniuKey):e.stamp=1e3*e.stamp,e.formatedDate=function(e,t,n){if(!e||"0"==e)return n||"";var i=new Date;10=="".concat(e).length&&(e*=1e3),i.setTime(e);var a={"M+":i.getMonth()+1,"d+":i.getDate(),"h+":i.getHours(),"m+":i.getMinutes(),"s+":i.getSeconds(),"q+":Math.floor((i.getMonth()+3)/3),S:i.getMilliseconds()};for(var o in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,"".concat(i.getFullYear()).substr(4-RegExp.$1.length))),a)new RegExp("(".concat(o,")")).test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[o]:"00".concat(a[o]).substr("".concat(a[o]).length)));return t}(e.stamp,"yyyy-MM-dd")})),a=e?c:a.concat(c),i.setState({imageList:a,imageTotal:o,extraLoadTimes:r+1},(function(){o>a.length&&r<4&&i.onGetMoreData()})),i.forceUpdate()})).finally((function(){i.setState({loading:!1})}))},i.onPreView=function(e,t,n){e.stopPropagation(),i.setState({preViewIndex:n,previewVisible:!0})},i.onSearch=function(e){i.setState({searchVal:e,isNewLoad:!0,pageNo:1,extraLoadTimes:0},(function(){i.onGetImages(!0)}))},i.onCopyLink=function(e,t){e.stopPropagation();var n=O+t.qiniu_key;!function(e){var t=document.createElement("input");t.value=e,t.style.opacity=0,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}(n),u.b.success("".concat(n," \u590d\u5236\u6210\u529f \ud83c\udf89"))},i.onGetMoreData=function(){var e=i.state.pageNo;i.setState({pageNo:e+1},(function(){i.onGetImages()}))},i.getImgSrc=function(e){var t=i.state.imgWidth;return S(e.realUrl,t)},i.imageListWrapRef=a.a.createRef(),i.fakeImageItemRef=a.a.createRef(),i.state={imageList:[],imageTotal:-1,loading:!0,preViewIndex:0,previewVisible:!1,searchVal:"",pageNo:1,extraLoadTimes:0,marinSearchSize:"default",searchMaxWidth:630,imgWidth:300},i}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.onGetImages(),this.onJudgeScreenWidth(),this.onJudgeMobile(),this.onSetSearchMaxWidth(),window.addEventListener("scroll",this.onBindScroll),this.onGetSmallPic()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.onBindScroll)}},{key:"render",value:function(){var e=this,t=this.state,n=t.imageList,i=t.isMobile,a=t.loading,o=t.imageTotal,c=t.marinSearchSize,s=t.previewVisible,r=t.preViewIndex,l=t.searchMaxWidth;return Object(N.jsxs)("div",{className:"image-container",children:[Object(N.jsx)("div",{className:"search-wrap",children:Object(N.jsx)(R,{placeholder:"input search text",enterButton:!0,onSearch:this.onSearch,size:c,style:{maxWidth:l}})}),Object(N.jsxs)("div",{className:"images-list-wrap",ref:this.imageListWrapRef,children:[Object(N.jsx)("div",{className:"image-item",ref:this.fakeImageItemRef,style:{visibility:"hidden"},children:Object(N.jsx)("div",{className:"image-wrap",children:Object(N.jsx)("img",{src:"http://img.uwayfly.com/3046.jpg",alt:"",className:"main-image"})})}),n.map((function(t,n){return Object(N.jsxs)("div",{className:"image-item",onClick:function(i){return e.onPreView(i,t,n)},children:[Object(N.jsxs)("div",{className:"image-wrap",children:[Object(N.jsx)(h.a,{title:i?"":t.showDesc,placement:"bottom",children:Object(N.jsx)(f.a,{height:200,children:Object(N.jsx)("img",{src:e.getImgSrc(t),alt:"",className:"main-image"})})}),!i&&Object(N.jsxs)("div",{className:"btn-line",children:[Object(N.jsx)("span",{className:"btn-line-left"}),Object(N.jsx)("span",{className:"btn-line-right",children:Object(N.jsx)(h.a,{title:"\u590d\u5236\u94fe\u63a5",placement:"top",children:Object(N.jsx)(j.a,{style:{fontSize:16},twoToneColor:"#52c41a ",onClick:function(n){return e.onCopyLink(n,t)}})})})]})]}),Object(N.jsx)("span",{className:"image-title",children:t.formatedDate})]},t.id)})),Object(N.jsx)("div",{className:"image-item-place"}),Object(N.jsx)("div",{className:"image-item-place"}),Object(N.jsx)("div",{className:"image-item-place"}),Object(N.jsx)("div",{className:"image-item-place"}),Object(N.jsx)("div",{className:"image-item-place"}),Object(N.jsx)("div",{className:"image-item-place"}),0===o&&Object(N.jsx)("div",{className:"no-data",children:a?"\u6b63\u5728\u52a0\u8f7d...":"\u6682\u65e0\u6570\u636e"})]}),Object(N.jsx)("div",{className:"loading-images",children:o<=0?null:n.length>=o?Object(N.jsxs)("span",{children:[Object(N.jsx)("i",{children:"\u2014\u2014\u2014\u2014"}),Object(N.jsx)("span",{children:"\u6211\u4e5f\u662f\u6709\u5e95\u7ebf\u7684"}),Object(N.jsx)("i",{children:"\u2014\u2014\u2014\u2014"})]}):a?"\u6b63\u5728\u52a0\u8f7d...":"\u4e0b\u62c9\u52a0\u8f7d\u66f4\u591a"}),s&&Object(N.jsx)(M,{imageList:n,preViewIndex:r,onGetMoreData:this.onGetMoreData,cancelModal:function(){return e.setState({previewVisible:!1})}}),Object(N.jsx)(g.a,{})]})}}]),n}(a.a.Component);var D=function(){return Object(N.jsx)("div",{className:"App",children:Object(N.jsx)(V,{})})},B=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,150)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),i(e),a(e),o(e),c(e)}))};c.a.render(Object(N.jsx)(D,{}),document.getElementById("root")),B()}},[[141,1,2]]]);
//# sourceMappingURL=main.ebba9d24.chunk.js.map